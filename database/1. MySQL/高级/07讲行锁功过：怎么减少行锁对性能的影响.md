# 07è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“



åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è·Ÿä½ ä»‹ç»äº†MySQLçš„å…¨å±€é”å’Œè¡¨çº§é”ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥è®²è®²MySQLçš„è¡Œé”ã€‚

MySQLçš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚MyISAMå¼•æ“å°±ä¸æ”¯æŒè¡Œé”ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚InnoDBæ˜¯æ”¯æŒè¡Œé”çš„ï¼Œè¿™ä¹Ÿæ˜¯MyISAMè¢«InnoDBæ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚

æˆ‘ä»¬ä»Šå¤©å°±ä¸»è¦æ¥èŠèŠInnoDBçš„è¡Œé”ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å‡å°‘é”å†²çªæ¥æå‡ä¸šåŠ¡å¹¶å‘åº¦ã€‚

é¡¾åæ€ä¹‰ï¼Œè¡Œé”å°±æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­è¡Œè®°å½•çš„é”ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚äº‹åŠ¡Aæ›´æ–°äº†ä¸€è¡Œï¼Œè€Œè¿™æ—¶å€™äº‹åŠ¡Bä¹Ÿè¦æ›´æ–°åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ç­‰äº‹åŠ¡Açš„æ“ä½œå®Œæˆåæ‰èƒ½è¿›è¡Œæ›´æ–°ã€‚

å½“ç„¶ï¼Œæ•°æ®åº“ä¸­è¿˜æœ‰ä¸€äº›æ²¡é‚£ä¹ˆä¸€ç›®äº†ç„¶çš„æ¦‚å¿µå’Œè®¾è®¡ï¼Œè¿™äº›æ¦‚å¿µå¦‚æœç†è§£å’Œä½¿ç”¨ä¸å½“ï¼Œå®¹æ˜“å¯¼è‡´ç¨‹åºå‡ºç°éé¢„æœŸè¡Œä¸ºï¼Œæ¯”å¦‚ä¸¤é˜¶æ®µé”ã€‚

## ä»ä¸¤é˜¶æ®µé”è¯´èµ·

æˆ‘å…ˆç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚åœ¨ä¸‹é¢çš„æ“ä½œåºåˆ—ä¸­ï¼Œäº‹åŠ¡Bçš„updateè¯­å¥æ‰§è¡Œæ—¶ä¼šæ˜¯ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿå‡è®¾å­—æ®µidæ˜¯è¡¨tçš„ä¸»é”®ã€‚
![img](img/51f501f718e420244b0a2ec2ce858710.jpg)

è¿™ä¸ªé—®é¢˜çš„ç»“è®ºå–å†³äºäº‹åŠ¡Aåœ¨æ‰§è¡Œå®Œä¸¤æ¡updateè¯­å¥åï¼ŒæŒæœ‰å“ªäº›é”ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ã€‚ä½ å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼šå®é™…ä¸Šäº‹åŠ¡Bçš„updateè¯­å¥ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡Aæ‰§è¡Œcommitä¹‹åï¼Œäº‹åŠ¡Bæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚

çŸ¥é“äº†è¿™ä¸ªç­”æ¡ˆï¼Œä½ ä¸€å®šçŸ¥é“äº†äº‹åŠ¡AæŒæœ‰çš„ä¸¤ä¸ªè®°å½•çš„è¡Œé”ï¼Œéƒ½æ˜¯åœ¨commitçš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œ**åœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚**

- **ç¼©çŸ­é”æŒæœ‰æ—¶é—´**

çŸ¥é“äº†è¿™ä¸ªè®¾å®šï¼Œå¯¹æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡æœ‰ä»€ä¹ˆå¸®åŠ©å‘¢ï¼Ÿ**é‚£å°±æ˜¯ï¼Œå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚**æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚

å‡è®¾ä½ è´Ÿè´£å®ç°ä¸€ä¸ªç”µå½±ç¥¨åœ¨çº¿äº¤æ˜“ä¸šåŠ¡ï¼Œé¡¾å®¢Aè¦åœ¨å½±é™¢Bè´­ä¹°ç”µå½±ç¥¨ã€‚æˆ‘ä»¬ç®€åŒ–ä¸€ç‚¹ï¼Œè¿™ä¸ªä¸šåŠ¡éœ€è¦æ¶‰åŠåˆ°ä»¥ä¸‹æ“ä½œï¼š

1. ä»é¡¾å®¢Aè´¦æˆ·ä½™é¢ä¸­æ‰£é™¤ç”µå½±ç¥¨ä»·ï¼›
2. ç»™å½±é™¢Bçš„è´¦æˆ·ä½™é¢å¢åŠ è¿™å¼ ç”µå½±ç¥¨ä»·ï¼›
3. è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦å®Œæˆè¿™ä¸ªäº¤æ˜“ï¼Œæˆ‘ä»¬éœ€è¦updateä¸¤æ¡è®°å½•ï¼Œå¹¶insertä¸€æ¡è®°å½•ã€‚å½“ç„¶ï¼Œä¸ºäº†ä¿è¯äº¤æ˜“çš„åŸå­æ€§ï¼Œæˆ‘ä»¬è¦æŠŠè¿™ä¸‰ä¸ªæ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚é‚£ä¹ˆï¼Œä½ ä¼šæ€æ ·å®‰æ’è¿™ä¸‰ä¸ªè¯­å¥åœ¨äº‹åŠ¡ä¸­çš„é¡ºåºå‘¢ï¼Ÿ

è¯•æƒ³å¦‚æœåŒæ—¶æœ‰å¦å¤–ä¸€ä¸ªé¡¾å®¢Cè¦åœ¨å½±é™¢Bä¹°ç¥¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäº‹åŠ¡å†²çªçš„éƒ¨åˆ†å°±æ˜¯è¯­å¥2äº†ã€‚å› ä¸ºå®ƒä»¬è¦æ›´æ–°åŒä¸€ä¸ªå½±é™¢è´¦æˆ·çš„ä½™é¢ï¼Œéœ€è¦ä¿®æ”¹åŒä¸€è¡Œæ•°æ®ã€‚

æ ¹æ®ä¸¤é˜¶æ®µé”åè®®ï¼Œä¸è®ºä½ æ€æ ·å®‰æ’è¯­å¥é¡ºåºï¼Œæ‰€æœ‰çš„æ“ä½œéœ€è¦çš„è¡Œé”éƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æŠŠè¯­å¥2å®‰æ’åœ¨æœ€åï¼Œæ¯”å¦‚æŒ‰ç…§3ã€1ã€2è¿™æ ·çš„é¡ºåºï¼Œé‚£ä¹ˆå½±é™¢è´¦æˆ·ä½™é¢è¿™ä¸€è¡Œçš„é”æ—¶é—´å°±æœ€å°‘ã€‚è¿™å°±æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡äº†å¹¶å‘åº¦ã€‚

å¥½äº†ï¼Œç°åœ¨ç”±äºä½ çš„æ­£ç¡®è®¾è®¡ï¼Œå½±é™¢ä½™é¢è¿™ä¸€è¡Œçš„è¡Œé”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸ä¼šåœç•™å¾ˆé•¿æ—¶é—´ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ä½ çš„å›°æ‰°ã€‚

å¦‚æœè¿™ä¸ªå½±é™¢åšæ´»åŠ¨ï¼Œå¯ä»¥ä½ä»·é¢„å”®ä¸€å¹´å†…æ‰€æœ‰çš„ç”µå½±ç¥¨ï¼Œè€Œä¸”è¿™ä¸ªæ´»åŠ¨åªåšä¸€å¤©ã€‚äºæ˜¯åœ¨æ´»åŠ¨æ—¶é—´å¼€å§‹çš„æ—¶å€™ï¼Œä½ çš„MySQLå°±æŒ‚äº†ã€‚ä½ ç™»ä¸ŠæœåŠ¡å™¨ä¸€çœ‹ï¼ŒCPUæ¶ˆè€—æ¥è¿‘100%ï¼Œä½†æ•´ä¸ªæ•°æ®åº“æ¯ç§’å°±æ‰§è¡Œä¸åˆ°100ä¸ªäº‹åŠ¡ã€‚è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ

è¿™é‡Œï¼Œæˆ‘å°±è¦è¯´åˆ°æ­»é”å’Œæ­»é”æ£€æµ‹äº†ã€‚

## æ­»é”å’Œæ­»é”æ£€æµ‹

å½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”ã€‚è¿™é‡Œæˆ‘ç”¨æ•°æ®åº“ä¸­çš„è¡Œé”ä¸¾ä¸ªä¾‹å­ã€‚
![img](img/4d0eeec7b136371b79248a0aed005a52.jpg)

è¿™æ—¶å€™ï¼Œäº‹åŠ¡Aåœ¨ç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾id=2çš„è¡Œé”ï¼Œè€Œäº‹åŠ¡Båœ¨ç­‰å¾…äº‹åŠ¡Aé‡Šæ”¾id=1çš„è¡Œé”ã€‚ äº‹åŠ¡Aå’Œäº‹åŠ¡Båœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š

> - ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥**è¿›å…¥ç­‰å¾…**ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®ã€‚
> - å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·**æ­»é”æ£€æµ‹**ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚

- **é”ç­‰å¾…**

åœ¨InnoDBä¸­ï¼Œinnodb_lock_wait_timeoutçš„é»˜è®¤å€¼æ˜¯50sï¼Œæ„å‘³ç€å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œå½“å‡ºç°æ­»é”ä»¥åï¼Œç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹è¦è¿‡50sæ‰ä¼šè¶…æ—¶é€€å‡ºï¼Œç„¶åå…¶ä»–çº¿ç¨‹æ‰æœ‰å¯èƒ½ç»§ç»­æ‰§è¡Œã€‚å¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆä¸å¯èƒ½ç›´æ¥æŠŠè¿™ä¸ªæ—¶é—´è®¾ç½®æˆä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œæ¯”å¦‚1sã€‚è¿™æ ·å½“å‡ºç°æ­»é”çš„æ—¶å€™ï¼Œç¡®å®å¾ˆå¿«å°±å¯ä»¥è§£å¼€ï¼Œä½†å¦‚æœä¸æ˜¯æ­»é”ï¼Œè€Œæ˜¯ç®€å•çš„é”ç­‰å¾…å‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¶…æ—¶æ—¶é—´è®¾ç½®å¤ªçŸ­çš„è¯ï¼Œä¼šå‡ºç°å¾ˆå¤šè¯¯ä¼¤ã€‚

- **ä¸»åŠ¨æ£€æµ‹æ­»é”**

æ‰€ä»¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¿˜æ˜¯è¦é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œå³ï¼šä¸»åŠ¨æ­»é”æ£€æµ‹ï¼Œè€Œä¸”innodb_deadlock_detectçš„é»˜è®¤å€¼æœ¬èº«å°±æ˜¯onã€‚ä¸»åŠ¨æ­»é”æ£€æµ‹åœ¨å‘ç”Ÿæ­»é”çš„æ—¶å€™ï¼Œæ˜¯èƒ½å¤Ÿå¿«é€Ÿå‘ç°å¹¶è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯æœ‰é¢å¤–è´Ÿæ‹…çš„ã€‚

ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼šæ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”çš„æ—¶å€™ï¼Œå°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«äººé”ä½ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”ã€‚

é‚£å¦‚æœæ˜¯æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„æ‰€æœ‰äº‹åŠ¡éƒ½è¦æ›´æ–°åŒä¸€è¡Œçš„åœºæ™¯å‘¢ï¼Ÿ

æ¯ä¸ªæ–°æ¥çš„è¢«å µä½çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­ä¼šä¸ä¼šç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯O(n)çš„æ“ä½œã€‚å‡è®¾æœ‰**1000ä¸ªå¹¶å‘çº¿ç¨‹è¦åŒæ—¶æ›´æ–°åŒä¸€è¡Œ**ï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹æ“ä½œå°±æ˜¯100ä¸‡è¿™ä¸ªé‡çº§çš„ã€‚è™½ç„¶æœ€ç»ˆæ£€æµ‹çš„ç»“æœæ˜¯æ²¡æœ‰æ­»é”ï¼Œä½†æ˜¯è¿™æœŸé—´è¦æ¶ˆè€—å¤§é‡çš„CPUèµ„æºã€‚å› æ­¤ï¼Œä½ å°±ä¼šçœ‹åˆ°CPUåˆ©ç”¨ç‡å¾ˆé«˜ï¼Œä½†æ˜¯æ¯ç§’å´æ‰§è¡Œä¸äº†å‡ ä¸ªäº‹åŠ¡ã€‚

æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ï¼Œæ€ä¹ˆè§£å†³ç”±è¿™ç§çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿé—®é¢˜çš„ç—‡ç»“åœ¨äºï¼Œ**æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„CPUèµ„æºã€‚**

**ä¸€ç§å¤´ç—›åŒ»å¤´çš„æ–¹æ³•ï¼Œå°±æ˜¯å¦‚æœä½ èƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰ã€‚**ä½†æ˜¯è¿™ç§æ“ä½œæœ¬èº«å¸¦æœ‰ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºä¸šåŠ¡è®¾è®¡çš„æ—¶å€™ä¸€èˆ¬ä¸ä¼šæŠŠæ­»é”å½“åšä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼Œæ¯•ç«Ÿå‡ºç°æ­»é”äº†ï¼Œå°±å›æ»šï¼Œç„¶åé€šè¿‡ä¸šåŠ¡é‡è¯•ä¸€èˆ¬å°±æ²¡é—®é¢˜äº†ï¼Œè¿™æ˜¯ä¸šåŠ¡æ— æŸçš„ã€‚è€Œå…³æ‰æ­»é”æ£€æµ‹æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„è¶…æ—¶ï¼Œè¿™æ˜¯ä¸šåŠ¡æœ‰æŸçš„ã€‚

- **é˜²æ­¢æ­»é”å‡ºç°**

**å¦ä¸€ä¸ªæ€è·¯æ˜¯æ§åˆ¶å¹¶å‘åº¦ã€‚**æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œä½ ä¼šå‘ç°å¦‚æœå¹¶å‘èƒ½å¤Ÿæ§åˆ¶ä½ï¼Œæ¯”å¦‚åŒä¸€è¡ŒåŒæ—¶æœ€å¤šåªæœ‰10ä¸ªçº¿ç¨‹åœ¨æ›´æ–°ï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹çš„æˆæœ¬å¾ˆä½ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªç›´æ¥çš„æƒ³æ³•å°±æ˜¯ï¼Œåœ¨å®¢æˆ·ç«¯åšå¹¶å‘æ§åˆ¶ã€‚ä½†æ˜¯ï¼Œä½ ä¼šå¾ˆå¿«å‘ç°è¿™ä¸ªæ–¹æ³•ä¸å¤ªå¯è¡Œï¼Œå› ä¸ºå®¢æˆ·ç«¯å¾ˆå¤šã€‚æˆ‘è§è¿‡ä¸€ä¸ªåº”ç”¨ï¼Œæœ‰600ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™æ ·å³ä½¿æ¯ä¸ªå®¢æˆ·ç«¯æ§åˆ¶åˆ°åªæœ‰5ä¸ªå¹¶å‘çº¿ç¨‹ï¼Œæ±‡æ€»åˆ°æ•°æ®åº“æœåŠ¡ç«¯ä»¥åï¼Œå³°å€¼å¹¶å‘æ•°ä¹Ÿå¯èƒ½è¦è¾¾åˆ°3000ã€‚

å› æ­¤ï¼Œè¿™ä¸ªå¹¶å‘æ§åˆ¶è¦åšåœ¨æ•°æ®åº“æœåŠ¡ç«¯ã€‚å¦‚æœä½ æœ‰ä¸­é—´ä»¶ï¼Œå¯ä»¥è€ƒè™‘åœ¨**ä¸­é—´ä»¶**å®ç°ï¼›å¦‚æœä½ çš„å›¢é˜Ÿæœ‰èƒ½**ä¿®æ”¹MySQLæºç **çš„äººï¼Œä¹Ÿå¯ä»¥åšåœ¨MySQLé‡Œé¢ã€‚åŸºæœ¬æ€è·¯å°±æ˜¯ï¼Œ**å¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿ**ã€‚è¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œäº†ã€‚

å¯èƒ½ä½ ä¼šé—®ï¼Œ**å¦‚æœå›¢é˜Ÿé‡Œæš‚æ—¶æ²¡æœ‰æ•°æ®åº“æ–¹é¢çš„ä¸“å®¶ï¼Œä¸èƒ½å®ç°è¿™æ ·çš„æ–¹æ¡ˆï¼Œèƒ½ä¸èƒ½ä»è®¾è®¡ä¸Šä¼˜åŒ–è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ**

ä½ å¯ä»¥è€ƒè™‘é€šè¿‡**å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çª**ã€‚è¿˜æ˜¯ä»¥å½±é™¢è´¦æˆ·ä¸ºä¾‹ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨å¤šæ¡è®°å½•ä¸Šï¼Œæ¯”å¦‚10ä¸ªè®°å½•ï¼Œå½±é™¢çš„è´¦æˆ·æ€»é¢ç­‰äºè¿™10ä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚è¿™æ ·æ¯æ¬¡è¦ç»™å½±é™¢è´¦æˆ·åŠ é‡‘é¢çš„æ—¶å€™ï¼Œéšæœºé€‰å…¶ä¸­ä¸€æ¡è®°å½•æ¥åŠ ã€‚è¿™æ ·æ¯æ¬¡å†²çªæ¦‚ç‡å˜æˆåŸæ¥çš„1/10ï¼Œå¯ä»¥å‡å°‘é”ç­‰å¾…ä¸ªæ•°ï¼Œä¹Ÿå°±å‡å°‘äº†æ­»é”æ£€æµ‹çš„CPUæ¶ˆè€—ã€‚

è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¸Šå»æ˜¯æ— æŸçš„ï¼Œä½†å…¶å®è¿™ç±»æ–¹æ¡ˆéœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘åšè¯¦ç»†è®¾è®¡ã€‚å¦‚æœè´¦æˆ·ä½™é¢å¯èƒ½ä¼šå‡å°‘ï¼Œæ¯”å¦‚é€€ç¥¨é€»è¾‘ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦è€ƒè™‘å½“ä¸€éƒ¨åˆ†è¡Œè®°å½•å˜æˆ0çš„æ—¶å€™ï¼Œä»£ç è¦æœ‰ç‰¹æ®Šå¤„ç†ã€‚

## å°ç»“

ä»Šå¤©ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†MySQLçš„è¡Œé”ï¼Œæ¶‰åŠäº†ä¸¤é˜¶æ®µé”åè®®ã€æ­»é”å’Œæ­»é”æ£€æµ‹è¿™ä¸¤å¤§éƒ¨åˆ†å†…å®¹ã€‚

å…¶ä¸­ï¼Œæˆ‘ä»¥ä¸¤é˜¶æ®µåè®®ä¸ºèµ·ç‚¹ï¼Œå’Œä½ ä¸€èµ·è®¨è®ºäº†åœ¨å¼€å‘çš„æ—¶å€™å¦‚ä½•å®‰æ’æ­£ç¡®çš„äº‹åŠ¡è¯­å¥ã€‚è¿™é‡Œçš„åŸåˆ™/æˆ‘ç»™ä½ çš„å»ºè®®æ˜¯ï¼šå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”çš„ç”³è¯·æ—¶æœºå°½é‡å¾€åæ”¾ã€‚

ä½†æ˜¯ï¼Œè°ƒæ•´è¯­å¥é¡ºåºå¹¶ä¸èƒ½å®Œå…¨é¿å…æ­»é”ã€‚æ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†æ­»é”å’Œæ­»é”æ£€æµ‹çš„æ¦‚å¿µï¼Œä»¥åŠæä¾›äº†ä¸‰ä¸ªæ–¹æ¡ˆï¼Œæ¥å‡å°‘æ­»é”å¯¹æ•°æ®åº“çš„å½±å“ã€‚å‡å°‘æ­»é”çš„ä¸»è¦æ–¹å‘ï¼Œå°±æ˜¯æ§åˆ¶è®¿é—®ç›¸åŒèµ„æºçš„å¹¶å‘äº‹åŠ¡é‡ã€‚

æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å§ã€‚å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰10000è¡Œæ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼š

- ç¬¬ä¸€ç§ï¼Œç›´æ¥æ‰§è¡Œdelete from T limit 10000;
- ç¬¬äºŒç§ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡ delete from T limit 500;
- ç¬¬ä¸‰ç§ï¼Œåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œdelete from T limit 500ã€‚

ä½ ä¼šé€‰æ‹©å“ªä¸€ç§æ–¹æ³•å‘¢ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚

### ä¸ŠæœŸé—®é¢˜æ—¶é—´

ä¸ŠæœŸæˆ‘ç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼šå½“å¤‡åº“ç”¨â€“single-transactionåšé€»è¾‘å¤‡ä»½çš„æ—¶å€™ï¼Œå¦‚æœä»ä¸»åº“çš„binlogä¼ æ¥ä¸€ä¸ªDDLè¯­å¥ä¼šæ€ä¹ˆæ ·ï¼Ÿ

å‡è®¾è¿™ä¸ªDDLæ˜¯é’ˆå¯¹è¡¨t1çš„ï¼Œ è¿™é‡Œæˆ‘æŠŠå¤‡ä»½è¿‡ç¨‹ä¸­å‡ ä¸ªå…³é”®çš„è¯­å¥åˆ—å‡ºæ¥ï¼š

```
Q1:SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
Q2:START TRANSACTION  WITH CONSISTENT SNAPSHOTï¼›
/* other tables */
Q3:SAVEPOINT sp;
/* æ—¶åˆ» 1 */
Q4:show create table `t1`;
/* æ—¶åˆ» 2 */
Q5:SELECT * FROM `t1`;
/* æ—¶åˆ» 3 */
Q6:ROLLBACK TO SAVEPOINT sp;
/* æ—¶åˆ» 4 */
/* other tables */
```

åœ¨å¤‡ä»½å¼€å§‹çš„æ—¶å€™ï¼Œä¸ºäº†ç¡®ä¿RRï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«ï¼Œå†è®¾ç½®ä¸€æ¬¡RRéš”ç¦»çº§åˆ«(Q1);

å¯åŠ¨äº‹åŠ¡ï¼Œè¿™é‡Œç”¨ WITH CONSISTENT SNAPSHOTç¡®ä¿è¿™ä¸ªè¯­å¥æ‰§è¡Œå®Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸€è‡´æ€§è§†å›¾ï¼ˆQ2)ï¼›

è®¾ç½®ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼ˆQ3ï¼‰ï¼›

show create æ˜¯ä¸ºäº†æ‹¿åˆ°è¡¨ç»“æ„(Q4)ï¼Œç„¶åæ­£å¼å¯¼æ•°æ® ï¼ˆQ5ï¼‰ï¼Œå›æ»šåˆ°SAVEPOINT spï¼Œåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯é‡Šæ”¾ t1çš„MDLé” ï¼ˆQ6ã€‚å½“ç„¶è¿™éƒ¨åˆ†å±äºâ€œè¶…çº²â€ï¼Œä¸Šæ–‡æ­£æ–‡é‡Œé¢éƒ½æ²¡æåˆ°ã€‚

DDLä»ä¸»åº“ä¼ è¿‡æ¥çš„æ—¶é—´æŒ‰ç…§æ•ˆæœä¸åŒï¼Œæˆ‘æ‰“äº†å››ä¸ªæ—¶åˆ»ã€‚é¢˜ç›®è®¾å®šä¸ºå°è¡¨ï¼Œæˆ‘ä»¬å‡å®šåˆ°è¾¾åï¼Œå¦‚æœå¼€å§‹æ‰§è¡Œï¼Œåˆ™å¾ˆå¿«èƒ½å¤Ÿæ‰§è¡Œå®Œæˆã€‚

å‚è€ƒç­”æ¡ˆå¦‚ä¸‹ï¼š

1. å¦‚æœåœ¨Q4è¯­å¥æ‰§è¡Œä¹‹å‰åˆ°è¾¾ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯DDLåçš„è¡¨ç»“æ„ã€‚
2. å¦‚æœåœ¨â€œæ—¶åˆ» 2â€åˆ°è¾¾ï¼Œåˆ™è¡¨ç»“æ„è¢«æ”¹è¿‡ï¼ŒQ5æ‰§è¡Œçš„æ—¶å€™ï¼ŒæŠ¥ Table definition has changed, please retry transactionï¼Œç°è±¡ï¼šmysqldumpç»ˆæ­¢ï¼›
3. å¦‚æœåœ¨â€œæ—¶åˆ»2â€å’Œâ€œæ—¶åˆ»3â€ä¹‹é—´åˆ°è¾¾ï¼Œmysqldumpå ç€t1çš„MDLè¯»é”ï¼Œbinlogè¢«é˜»å¡ï¼Œç°è±¡ï¼šä¸»ä»å»¶è¿Ÿï¼Œç›´åˆ°Q6æ‰§è¡Œå®Œæˆã€‚
4. ä»â€œæ—¶åˆ»4â€å¼€å§‹ï¼Œmysqldumpé‡Šæ”¾äº†MDLè¯»é”ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯DDLå‰çš„è¡¨ç»“æ„ã€‚

è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š

> @Aurora ç»™äº†æœ€æ¥è¿‘çš„ç­”æ¡ˆï¼›
> @echoï¼¿é™ˆ é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼›
> @å£¹ç¬™â˜æ¼‚æ³Š åšäº†å¾ˆå¥½çš„æ€»ç»“ã€‚

![img](img/ce7f4e35916ed1aa49206a53a0547bd9-1579696233465.jpg)

### ç²¾é€‰ç•™è¨€

- 

  bluefantasy3

  è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼š
  innodbè¡Œçº§é”æ˜¯é€šè¿‡é”ç´¢å¼•è®°å½•å®ç°çš„ã€‚å¦‚æœupdateçš„åˆ—æ²¡å»ºç´¢å¼•ï¼Œå³ä½¿åªupdateä¸€æ¡è®°å½•ä¹Ÿä¼šé”å®šæ•´å¼ è¡¨å—ï¼Ÿæ¯”å¦‚update t set t.name='abc' where t.name='cde'; nameå­—æ®µæ— ç´¢å¼•ã€‚ä¸ºä½•innodbä¸ä¼˜åŒ–ä¸€ä¸‹ï¼Œåªé”å®šname='cde'çš„åˆ—ï¼Ÿ

  2018-11-28 08:17

  ä½œè€…å›å¤

  ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¥½é—®é¢˜ï¼Œæˆ‘åŠ åˆ°ç­”ç–‘æ–‡ç« ä¸­ã€‚ç®€å•çš„å›ç­”ï¼šæ˜¯çš„ã€‚ä½†æ˜¯ä½ å¯ä»¥å†å¾€å‰è€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯ ä½ çš„update è¯­å¥åé¢åŠ ä¸ªlimit 1, ä¼šæ€ä¹ˆé”ï¼Ÿ


  Innodbæ”¯æŒè¡Œé”ï¼Œæ²¡æœ‰æ”¯æŒâ€œåˆ—é”â€ å“ˆğŸ˜„

  

  2018-11-28 10:25

- 

  è’æ¼ ç”˜æ³‰

  è€å¸ˆï¼Œæœ¬èŠ‚è¯¾è®²çš„ä¸æ”¯æŒè¡Œé”çš„å¼•æ“ï¼Œåªèƒ½ä½¿ç”¨è¡¨é”ï¼Œè€Œè¡¨é”åŒä¸€å¼ è¡¨åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°ã€‚ä½†æ˜¯ä¸ŠèŠ‚è¯¾è®²çš„è¡¨çº§é”ä¸­çš„MDLé”ï¼Œdmlè¯­å¥ä¼šäº§ç”ŸMDLè¯»é”ï¼Œè€ŒMDLè¯»é”ä¸æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼ è¡¨å¯ä»¥åŒæ—¶æœ‰å¤šä¸ªdmlè¯­å¥æ“ä½œã€‚æ„Ÿè§‰è¿™ä¸¤ç§è¯´æ³•æœ‰ç‚¹çŸ›ç›¾ï¼Œè¯·è€å¸ˆè§£æƒ‘ï¼

  2018-11-28 19:29

  ä½œè€…å›å¤

  ä¸çŸ›ç›¾ï¼ŒMDLé”å’Œè¡¨é”æ˜¯ä¸¤ä¸ªä¸åŒçš„ç»“æ„ã€‚

  æ¯”å¦‚ï¼š
  ä½ è¦åœ¨myisam è¡¨ä¸Šæ›´æ–°ä¸€è¡Œï¼Œé‚£ä¹ˆä¼šåŠ MDLè¯»é”å’Œè¡¨çš„å†™é”ï¼›
  ç„¶ååŒæ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¦æ›´æ–°è¿™ä¸ªè¡¨ä¸Šå¦å¤–ä¸€è¡Œï¼Œä¹Ÿè¦åŠ MDLè¯»é”å’Œè¡¨å†™é”ã€‚

  ç¬¬äºŒä¸ªçº¿ç¨‹çš„*MDLè¯»é”æ˜¯èƒ½æˆåŠŸåŠ ä¸Š*çš„ï¼Œä½†æ˜¯è¢«è¡¨å†™é”å µä½äº†ã€‚ä»è¯­å¥ç°è±¡ä¸Šçœ‹ï¼Œå°±æ˜¯ç¬¬äºŒä¸ªçº¿ç¨‹è¦ç­‰ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆã€‚

  2018-11-28 20:54

- 

  æœ¨æœ¨åŒ—æœˆç”Ÿ

  è€å¸ˆï¼Œå…³äºæ­»é”æ£€æµ‹innodb_deadlock_detectæˆ‘æƒ³è¯·æ•™ä¸€ä¸‹ï¼Œæ˜¯æ¯æ¡äº‹åŠ¡æ‰§è¡Œå‰éƒ½ä¼šè¿›è¡Œæ£€æµ‹å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œå³ä½¿ç®€å•çš„æ›´æ–°å•ä¸ªè¡¨çš„è¯­å¥ï¼Œå½“æ¯ç§’çš„å¹¶å‘é‡è¾¾åˆ°ä¸Šåƒçš„è¯ï¼Œå²‚ä¸æ˜¯ä¹Ÿä¼šæ¶ˆè€—å¤§é‡èµ„æºç”¨äºæ­»é”æ£€æµ‹å—ï¼Ÿ

  2018-12-03 14:28

  ä½œè€…å›å¤

  æ˜¯ä¸ªå¥½é—®é¢˜
  å¦‚æœä»–è¦åŠ é”è®¿é—®çš„è¡Œä¸Šæœ‰é”ï¼Œä»–æ‰è¦æ£€æµ‹ã€‚

  è¿™é‡Œé¢æˆ‘æ‹…å¿ƒä½ æœ‰ä¸¤ä¸ªè¯¯è§£ï¼Œè¯´æ˜ä¸‹ï¼š
  \1. ä¸€è‡´æ€§è¯»ä¸ä¼šåŠ é”ï¼Œå°±ä¸éœ€è¦åšæ­»é”æ£€æµ‹ï¼›

  \2. å¹¶ä¸æ˜¯æ¯æ¬¡æ­»é”æ£€æµ‹éƒ½éƒ½è¦æ‰«æ‰€æœ‰äº‹åŠ¡ã€‚æ¯”å¦‚æŸä¸ªæ—¶åˆ»ï¼Œäº‹åŠ¡ç­‰å¾…çŠ¶æ€æ˜¯è¿™æ ·çš„ï¼š

  Båœ¨ç­‰Aï¼Œ
  Dåœ¨ç­‰Cï¼Œ
  ç°åœ¨æ¥äº†ä¸€ä¸ªEï¼Œå‘ç°Eéœ€è¦ç­‰Dï¼Œé‚£ä¹ˆEå°±åˆ¤æ–­è·ŸDã€Cæ˜¯å¦ä¼šå½¢æˆæ­»é”ï¼Œè¿™ä¸ªæ£€æµ‹ä¸ç”¨ç®¡Bå’ŒA

  2018-12-03 14:57

- 

  æŸã€äºº

  è€å¸ˆï¼Œé’ˆå¯¹æˆ‘çš„ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘å°±æ˜¯æƒ³é—®æ€ä¹ˆèƒ½æ‹¿åˆ°æ¯”è¾ƒå…¨å¾—æ­»é”ä¿¡æ¯ä»¥åŠæŠŠè¿™äº›ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶é‡Œã€‚
  ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚æœresetä»¥åï¼Œæ˜¯ä¸æ˜¯å°±å¤±å»äº†é•¿è¿æ¥çš„æ„ä¹‰äº†å‘¢ï¼Ÿç›¸å½“äºå†æ¬¡è¿›è¡Œè¿æ¥ã€‚

  2018-11-28 23:15

  ä½œè€…å›å¤

  \1. å°±æ˜¯æŒç»­ç›‘æ§ï¼Œå‘ç°æ–°çš„å°±å­˜èµ·æ¥

  \2. ä¸ä¼šï¼Œreset_connectionåªæ˜¯å¤ä½çŠ¶æ€ï¼Œæ¢å¤åˆ°è¿æ¥å’Œæƒé™éªŒè¯ä¹‹åçš„çŠ¶æ€ï¼Œæ²¡æœ‰é‡è¿

  2018-11-29 01:59

- 

  ä¸‰æœ¨ç¦¾

  è€å¸ˆï¼Œå¦‚æœå¼€å¯äº‹åŠ¡ï¼Œç„¶åè¿›è¡Œæ­»é”æ£€æµ‹ï¼Œå¦‚æœå‘ç°æœ‰å…¶å®ƒçº¿ç¨‹å› ä¸ºè¿™ä¸ªçº¿ç¨‹çš„åŠ å…¥ï¼Œå¯¼è‡´å…¶å®ƒçº¿ç¨‹çš„æ­»é”ï¼Œè¿™ä¸ªæµç¨‹èƒ½å¸®ç€åˆ†æä¸€ä¸‹ä¹ˆ

  2018-12-14 07:56

  ä½œè€…å›å¤

  å¥½é—®é¢˜

  ç†è®ºä¸Šè¯´ï¼Œä¹‹å‰æ²¡æ­»é”ï¼Œç°åœ¨AåŠ è¿›æ¥ï¼Œå‡ºç°äº†æ­»é”ï¼Œé‚£ä¹ˆæ­»é”çš„ç¯é‡Œé¢è‚¯å®šåŒ…å«Aï¼Œ
  å› æ­¤åªè¦ä»Aå‡ºå‘å»æ‰«å°±å¥½äº†

  2018-12-14 09:10

- 

  è“å¤©

  è€å¸ˆï¼šä¸Šä¸€èŠ‚è®²çš„dmlæ—¶ä¼šäº§ç”Ÿè¯»MDLé”ï¼ˆè¡¨é”ï¼‰ï¼Œä¹Ÿå°±æ˜¯updateä¼šæŒæœ‰è¯»MDLã€‚è¯»å’Œè¯»ä¸äº’æ–¥ã€‚ä½†æ˜¯å¯¹äºè¡Œé”æ¥è¯´ã€‚ä¸¤ä¸ªupdateåŒæ—¶æ›´æ–°ä¸€æ¡æ•°æ®æ˜¯äº’æ–¥çš„ã€‚è¿™ä¸ªæ˜¯å› ä¸ºå¤šç§é”åŒæ—¶å­˜åœ¨æ—¶ï¼Œä»¥ç²’åº¦æœ€å°çš„é”ä¸ºå‡†çš„åŸå› ä¹ˆï¼Ÿ

  2019-01-09 17:51

  ä½œè€…å›å¤

  ä¸æ˜¯â€œä»¥ç²’åº¦æœ€å°ä¸ºå‡†â€
  è€Œæ˜¯å¦‚æœæœ‰å¤šç§é”ï¼Œå¿…é¡»å¾—â€œå…¨éƒ¨ä¸äº’æ–¥â€æ‰èƒ½å¹¶è¡Œï¼Œåªè¦æœ‰ä¸€ä¸ªäº’æ–¥ï¼Œå°±å¾—ç­‰ã€‚

  å¥½é—®é¢˜

  2019-01-09 22:12

- 

  æ­¦è€…

  è€å¸ˆ ä½ å¥½
  æœ‰ä»¥ä¸‹æƒ…å†µ å¸®å¿™åˆ†æä¸‹ä¼šé”è¡¨ä¸

  update aï¼Œb set a.name = b.name where a.uid=b.uid and b.group=1ï¼›
  update cï¼Œb set c.age=b.age where c.uid=b.uid and b.group = 1ï¼›

  å¦‚æœä¸¤ä¸ªè¯­å¥åŒæ—¶æ‰§è¡ŒæœŸé—´ æ˜¯ä¸æ˜¯æœ‰ä¸ªæ‰§è¡Œä¸äº† è¦ç­‰bè§£é”ã€‚è¿˜æ˜¯è¯´æ²¡æœ‰æ›´æ–°bçš„å­—æ®µbä¸ä¼šé”ï¼Œä¸¤ä¸ªå¯å¹¶è¡Œæ‰§è¡Œ
  è¯·è€å¸ˆæŒ‡å¯¼ä¸‹

  

  2018-11-29 18:14

  ä½œè€…å›å¤

  è¿™ä¸ªä½ å¾—åŒæ—¶è´´è¡¨ç»“æ„ã€‚

  è¿˜æœ‰ï¼Œä¼šä¸ä¼šé”ï¼Œä¸æ˜¯éªŒè¯ä¸€ä¸‹å°±å¯ä»¥å—ï¼Œä¸¤ä¸ªéƒ½ç”¨begin + è¯­å¥ï¼Œ

  ä¸¤é˜¶æ®µé”åè®®ä¼šå¸®åŠ©ä½ ğŸ˜„

  2018-11-29 21:22

- 

  æ³‰

  æˆ‘é€‰ç¬¬äºŒç§ã€‚
  ç¬¬ä¸€ç§ï¼Œéœ€è¦é”èµ„æºå¤šï¼Œäº‹åŠ¡è¾ƒå¤§ï¼ŒæŒæœ‰é”æ—¶é—´æœ€é•¿ã€‚
  ç¬¬ä¸‰ç§ï¼Œå¤šä¸ªäº‹åŠ¡ä¼šå¯¹åŒä¸€è¡Œäº§ç”Ÿé”ç«äº‰ï¼Œæ¶ˆè€—cpuèµ„æºã€‚
  è¯·æŒ‡æ­£ã€‚

  2018-11-28 07:25

- 

  Tony Du

  æ–¹æ¡ˆä¸€ï¼Œäº‹åŠ¡ç›¸å¯¹è¾ƒé•¿ï¼Œåˆ™å ç”¨é”çš„æ—¶é—´è¾ƒé•¿ï¼Œä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…èµ„æºæ—¶é—´è¾ƒé•¿ã€‚
  æ–¹æ¡ˆäºŒï¼Œä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œå°†ç›¸å¯¹é•¿çš„äº‹åŠ¡åˆ†æˆå¤šæ¬¡ç›¸å¯¹çŸ­çš„äº‹åŠ¡ï¼Œåˆ™æ¯æ¬¡äº‹åŠ¡å ç”¨é”çš„æ—¶é—´ç›¸å¯¹è¾ƒçŸ­ï¼Œå…¶ä»–å®¢æˆ·ç«¯åœ¨ç­‰å¾…ç›¸åº”èµ„æºçš„æ—¶é—´ä¹Ÿè¾ƒçŸ­ã€‚è¿™æ ·çš„æ“ä½œï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ç€å°†èµ„æºåˆ†ç‰‡ä½¿ç”¨ï¼ˆæ¯æ¬¡æ‰§è¡Œä½¿ç”¨ä¸åŒç‰‡æ®µçš„èµ„æºï¼‰ï¼Œå¯ä»¥æé«˜å¹¶å‘æ€§ã€‚
  æ–¹æ¡ˆä¸‰ï¼Œäººä¸ºè‡ªå·±åˆ¶é€ é”ç«äº‰ï¼ŒåŠ å‰§å¹¶å‘é‡ã€‚
  æ–¹æ¡ˆäºŒç›¸å¯¹æ¯”è¾ƒå¥½ï¼Œå…·ä½“è¿˜è¦ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯ã€‚

  å¦ï¼Œå¯¹äºinnodbçš„è¡Œé”ï¼Œæˆ‘è§‰å¾—å¯ä»¥å¢åŠ ä¸€è®²ï¼Œå¦‚ä½•åŠ é”ï¼ˆä¾èµ–äºå…·ä½“çš„éš”ç¦»çº§åˆ«ï¼Œæ˜¯å¦æœ‰ç´¢å¼•ï¼Œæ˜¯å¦æ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒSQLçš„æ‰§è¡Œè®¡åˆ’ï¼‰ï¼Œç‰¹åˆ«æ˜¯åœ¨RRéš”ç¦»çº§åˆ«ä¸‹çš„GAPé”ï¼Œå¯¹äºinnodbï¼ŒRRçº§åˆ«æ˜¯å¯ä»¥é˜²æ­¢å¹»è¯»çš„ã€‚

  2018-11-28 11:31

  ä½œè€…å›å¤

  åˆ†æå¾—å¾ˆå¥½ã€‚

  å—¯å—¯ç´¢å¼•å’Œé”çš„å†…å®¹å¾ˆå¤šï¼Œä¹Ÿæ˜¯éœ€è¦æ…¢æ…¢å®‰æ’ğŸ˜„
  çªç„¶ä¸Šæ¦‚å¿µæ€•å¤§å®¶çœ‹å¾—ä¸å¼€å¿ƒğŸ˜“

  2018-11-28 12:36

- 

  WL

  ç»§ç»­æŠŠè¯¥è®²å†…å®¹æ€»ç»“ä¸ºå‡ ä¸ªé—®é¢˜, å¤§å®¶å¤ä¹ çš„æ—¶å€™å¯ä»¥å…ˆå°è¯•å›ç­”è¿™äº›é—®é¢˜æ£€æŸ¥è‡ªå·±çš„æŒæ¡ç¨‹åº¦:
  1.
  ä¸¤é˜¶æ®µé”çš„æ¦‚å¿µæ˜¯ä»€ä¹ˆ? å¯¹äº‹åŠ¡ä½¿ç”¨æœ‰ä»€ä¹ˆå¸®åŠ©?
  2.
  æ­»é”çš„æ¦‚å¿µæ˜¯ä»€ä¹ˆ? ä¸¾ä¾‹è¯´æ˜å‡ºç°æ­»é”çš„æƒ…å†µ.
  3.
  æ­»é”çš„å¤„ç†ç­–ç•¥æœ‰å“ªä¸¤ç§?
  4.
  ç­‰å¾…è¶…æ—¶å¤„ç†æ­»é”çš„æœºåˆ¶ä»€ä¹ˆ?æœ‰ä»€ä¹ˆå±€é™?
  5.
  æ­»é”æ£€æµ‹å¤„ç†æ­»é”çš„æœºåˆ¶æ˜¯ä»€ä¹ˆ? æœ‰ä»€ä¹ˆå±€é™?
  6.
  æœ‰å“ªäº›æ€è·¯å¯ä»¥è§£å†³çƒ­ç‚¹æ›´æ–°å¯¼è‡´çš„å¹¶å‘é—®é¢˜?

  

  2018-12-01 11:36

  ä½œè€…å›å¤

  ç»§ç»­æ‰‹åŠ¨ğŸ‘ğŸ¿

  2018-12-01 12:29

- 

  æŸã€äºº

  è€å¸ˆæˆ‘æœ‰å‡ ä¸ªé—®é¢˜:
  1.å¦‚ä½•åœ¨æ­»é”å‘ç”Ÿæ—¶,å°±æŠŠå‘ç”Ÿçš„sqlè¯­å¥æŠ“å‡ºæ¥ï¼Ÿ
  2.åœ¨ä½¿ç”¨è¿æ¥æ± çš„æƒ…å†µä¸‹,è¿æ¥ä¼šå¤ç”¨.æ¯”å¦‚ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨è¿æ¥set sql_select_limit=1,é‡Šæ”¾æ‰ä»¥å.å…¶ä»–ä¸šåŠ¡å¤ç”¨è¯¥è¿æ¥æ—¶,è¿™ä¸ªå‚æ•°ä¹Ÿç”Ÿæ•ˆ.è¯·é—®æ€ä¹ˆé¿å…è¿™ç§æƒ…å†µ,æˆ–è€…æ€ä¹ˆç¦æ­¢ä¸šåŠ¡set sessionï¼Ÿ
  3.å¾ˆå¥½å¥‡åŒ11çš„æˆäº¤é¢,æ˜¯é€šè¿‡redisç´¯åŠ çš„å˜›ï¼Ÿ
  4.ä¸ä¼šæ”¹æºç èƒ½æˆä¸ºä¸“å®¶å˜›ï¼ŸğŸ˜„

  

  2018-11-28 20:58

  ä½œè€…å›å¤

  \1. show engine innodb status é‡Œé¢æœ‰ä¿¡æ¯ï¼Œä¸è¿‡ä¸æ˜¯å¾ˆå…¨â€¦
  \2. 5.7çš„reset_connectionæ¥å£å¯ä»¥è€ƒè™‘ä¸€ä¸‹
  \3. ç”¨redisçš„è¯ï¼Œä¸ºäº†é¿å…è¶…å–éœ€è¦å¢åŠ äº†å¾ˆå¤šæœºåˆ¶æ¥ä¿è¯ã€‚ä¿®æ”¹éƒ½åœ¨æ•°æ®åº“é‡Œæ‰§è¡Œå°±æ–¹ä¾¿ç‚¹ã€‚å‰ææ˜¯è¦è§£å†³çƒ­ç‚¹é—®é¢˜
  \4. æˆ‘è®¤è¯†å‡ ä½å¤„ç†é—®é¢˜å’Œåˆ†æé—®é¢˜ç»éªŒéå¸¸ä¸°å¯Œçš„ä¸“å®¶ï¼Œä¸ç”¨æ‡‚æºç ï¼Œä½†æ˜¯åŸç†è¿˜æ˜¯è¦å¾ˆæ¸…æ¥šçš„

  2018-11-28 23:43

- 

  å²æœˆå®‰ç„¶

  æ€»ç»“ï¼š
  ä¸¤é˜¶æ®µé”ï¼šåœ¨ InnoDB äº‹åŠ¡ä¸­ï¼Œï¨ˆé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ï¥§æ˜¯ï¥§éœ€è¦ï¦ºå°±ç«‹åˆ»é‡Šæ”¾ï¼Œ è€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚
  å»ºè®®ï¼šå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚
  æ­»é”ï¼šå½“å¹¶å‘ç³»ç»Ÿä¸­ï¥§åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ã€‚
  è§£å†³æ–¹æ¡ˆï¼š
  1ã€é€šè¿‡å‚æ•° innodb_lock_wait_timeout æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ŒInnoDBå¼•æ“é»˜è®¤å€¼æ˜¯50sã€‚
  2ã€å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§ï¨ˆã€‚å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼ˆé»˜è®¤æ˜¯å¼€å¯çŠ¶æ€ï¼‰ã€‚
  å¦‚ä½•è§£å†³çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Ÿ
  1ã€å¦‚æœä½ èƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³é—­æ‰ã€‚ä¸€èˆ¬ä¸å»ºè®®é‡‡ç”¨
  2ã€æ§åˆ¶å¹¶å‘åº¦ï¼Œå¯¹åº”ç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿã€‚è¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œäº†ã€‚
  3ã€å°†çƒ­æ›´æ–°çš„è¡Œæ•°æ®æ‹†åˆ†æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªï¼Œä½†æ˜¯ä¸šåŠ¡å¤æ‚åº¦å¯èƒ½ä¼šå¤§å¤§æé«˜ã€‚

  innodbè¡Œçº§é”æ˜¯é€šè¿‡é”ç´¢å¼•è®°å½•å®ç°çš„ï¼Œå¦‚æœæ›´æ–°çš„åˆ—æ²¡å»ºç´¢å¼•æ˜¯ä¼šé”ä½æ•´ä¸ªè¡¨çš„ã€‚

  2018-11-29 11:05

  ä½œè€…å›å¤

  ğŸ‘ğŸ¿è¿™ä¸ªæ€»ç»“

  2018-11-29 12:09

- 

  é”…å­

  è€å¸ˆå¥½ï¼Œå…³äºä¸Šä¸€æœŸçš„é—®é¢˜æˆ‘æœ‰2ç–‘é—®ï¼š
  1.Q2ï¼ŒWITH CONSISTENT SNAPSHOTè¯­å¥æ‰§è¡Œå®Œå¯ä»¥ç¡®ä¿å¾—åˆ°ä¸€ä¸ªä¸€è‡´æ€§è§†å›¾ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå¤‡ä»½åˆ°Q2æ—¶é—´ç‚¹ä¹‹åæ›´æ”¹çš„è¡¨ç»“æ„å•Šï¼Ÿå¦‚æœè¿™æ ·é‚£æ˜¯ä¸æ˜¯æ„å‘³ç€å¦‚æœæœ‰ä¸€ä¸ªæ•°æ®åº“ä¸€ç›´æœ‰æ•°æ®åœ¨å†™å…¥çš„è¯ï¼Œå¤‡ä»½ä¼šä¸€ç›´éƒ½æ— æ³•å®Œæˆã€‚
  2.Q3è®¾ç½®äº†ä¿å­˜ç‚¹ï¼Œä¹‹åè¯»åˆ°ä¸»åº“çš„DDLè¯­å¥ï¼Œé‚£Q6åˆå›æ»šåˆ°äº†Q3è®¾ç½®çš„ä¿å­˜ç‚¹ï¼Œé‚£æ˜¯ä¸æ˜¯å°±ä¸»ä»ä¸ä¸€è‡´äº†å•Šï¼Ÿ

  2018-11-28 09:41

- 

  Tan

  ä¸è€ƒè™‘æ•°æ®è¡¨çš„è®¿é—®å¹¶å‘é‡ï¼Œå•çº¯ä»è¿™ä¸ªä¸‰ä¸ªæ–¹æ¡ˆæ¥å¯¹æ¯”çš„è¯ã€‚
  ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œä¸€æ¬¡å ç”¨çš„é”æ—¶é—´è¾ƒé•¿ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯ä¸€ç›´åœ¨ç­‰å¾…èµ„æºã€‚
  ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œåˆ†æˆå¤šæ¬¡å ç”¨é”ï¼Œä¸²è¡Œæ‰§è¡Œï¼Œä¸å æœ‰é”çš„é—´éš™å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥å·¥ä½œï¼Œç±»ä¼¼äºç°åœ¨å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿçš„æ—¶é—´åˆ†ç‰‡è°ƒåº¦ï¼Œå¤§å®¶åˆ†ç‰‡ä½¿ç”¨èµ„æºï¼Œä¸ç›´æ¥å½±å“ä½¿ç”¨ã€‚
  ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆï¼Œè‡ªå·±åˆ¶é€ äº†é”ç«äº‰ï¼ŒåŠ å‰§å¹¶å‘ã€‚
  è‡³äºé€‰å“ªä¸€ç§æ–¹æ¡ˆè¦ç»“åˆå®é™…åœºæ™¯ï¼Œç»¼åˆè€ƒè™‘å„ä¸ªå› ç´ å§ï¼Œæ¯”å¦‚è¡¨çš„å¤§å°ï¼Œå¹¶å‘é‡ï¼Œä¸šåŠ¡å¯¹æ­¤è¡¨çš„ä¾èµ–ç¨‹åº¦ç­‰ã€‚

  2018-11-28 08:41

- 

  shawn

  è¯è¯´ç•™è¨€ç³»ç»Ÿæ‰“ä¸å‡ºå¤§äºå°äºå·æ˜¯ä¸ºäº†é˜²æ­¢xssæ”»å‡»å§ï¼Œæ¨èä¸‹ï¼Œèƒ½ä¸èƒ½ç”¨ä½œè½¬ä¹‰çš„æ–¹å¼è§£å†³å‘¢ï¼Œç•™è¨€é‡Œå°äºnow()æ•´ä¸ªæ²¡æœ‰ä¹‹åè¯­å¥ä¸é€šäº†
  æŠ€æœ¯å‘çš„æœåŠ¡è‡ªå·±çš„æŠ€æœ¯å¾—è¿‡å…³å§(æ‰‹åŠ¨æ»‘ç¨½)

  2018-11-29 08:21

- 

  é‚“ä¿Š

  ç­”é¢˜ï¼š
  è¿™ä¸ªè¦çœ‹æ•°æ®åº“å‹åŠ›ï¼Œå¦‚æœæ•°æ®åº“éå¸¸ç©ºé—²ï¼Œæˆ‘é€‰æ–¹æ¡ˆä¸€ï¼Œè¿™æ ·æ“ä½œç®€å•ã€‚å¦‚æœæ•°æ®åº“ä¸­è¿™å¼ è¡¨çš„å‹åŠ›éå¸¸å¤§ï¼Œæˆ‘é€‰æ–¹æ¡ˆä¸‰ï¼Œæç«¯æƒ…å†µä¸‹ç”šè‡³æˆ‘ä¼šåˆ¶å®šæ–¹æ¡ˆå››ï¼Œæ¯æ¬¡åªåˆ ä¸€æ¡ã€‚

  è€å¸ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼š
  ä¾‹é¢˜ä¸­çš„è®¢ç¥¨ç³»ç»Ÿï¼Œå½±é™¢çš„ä½™é¢è¡¨å¯ä¸å¯ä»¥ç”¨æµæ°´çš„æ–¹å¼æ¥è®°å½•ï¼Œæ¯å¤©é—²æ—¶æ±‡æ€»ä¸€æ¬¡ï¼Œè¿™æ ·å°±æ²¡æœ‰updateåªæœ‰insertå’Œselect sumäº†ã€‚

  ç”¨æ‰‹æœºæ‰“å­—å¥½ç´¯ï¼Œè¡¨è¾¾çš„ä¸è¯¦ç»†ï¼Œè¯·è°…è§£ã€‚

  2018-11-28 02:33

  ä½œè€…å›å¤

  å—¯ï¼Œå¦‚æœæ˜¯æ²¡æœ‰è¾¹ç•Œæ¡ä»¶ï¼Œæ¯”å¦‚ä¸€ç›´åŠ é’±ï¼Œè¿™ç§å¯ä»¥çš„ã€‚ä½†æ˜¯å¦‚æœæœ‰â€œé€€æ¬¾â€çš„é€»è¾‘ï¼Œå°±ä¸è¡Œäº†ã€‚åªè®°æ—¥å¿—å¯èƒ½ä¼šç»™æ‰£æˆè´Ÿæ•°ã€‚

  2018-11-28 18:48

- 

  Aurora

  é’ˆå¯¹ç¬¬ä¸€å±‚æ¥¼ä¸»æåˆ°çš„é—®é¢˜ï¼Œæˆ‘è®°å¾—æ˜¯ï¼Œå¦‚æœupdate æ²¡æœ‰èµ°ç´¢å¼•ï¼Œinnodbå†…éƒ¨æ˜¯å…¨è¡¨æ ¹æ®ä¸»é”®ç´¢å¼•é€è¡Œæ‰«æ é€è¡ŒåŠ é”ï¼Œé‡Šæ”¾é”ã€‚

  2018-11-28 20:13

  ä½œè€…å›å¤

  é€è¡ŒåŠ é”ï¼Œ

  äº‹åŠ¡æäº¤çš„æ—¶å€™ç»Ÿä¸€é‡Šæ”¾ã€‚â€” è®°å¾—ä¸¤é˜¶æ®µé”å“ˆ

  2018-11-28 20:44

- 

  everyok22

  ä»Šå¤©é‡è¯»äº†ä¸€ä¸‹è¿™ä¸ªè¡¨é”ï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¸Œæœ›è€å¸ˆç»™è§£ç­”ä¸€ä¸‹ï¼š
  æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªç”¨æˆ·é¢†å–å¥–å£çš„ä¸šåŠ¡ï¼Œã€€ä¸šåŠ¡é‡Œæœ‰å¥–å“è¡¨ï¼šæ„é€ è¯­å¥å¦‚ä¸‹
  CREATE TABLE `prize` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `name` varchar(20) DEFAULT NULL COMMENT 'ç”¨æˆ·å',
  `status` int(11) NOT NULL COMMENT 'çŠ¶æ€ï¼ˆ0è¡¨ç¤ºæœªå‘ç»™ç”¨æˆ·ï¼Œ1è¡¨ç¤ºå·²å‘ç»™ç”¨æˆ·ï¼‰',
  `passwd` varchar(64) DEFAULT NULL COMMENT 'å¡å¯†',
  PRIMARY KEY (`id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

  è¿™ä¸ªå¥–å“ä¸åŒäºå•†å“ï¼Œä»–æœ‰ä¸€å®šçš„ç‰¹æ®Šæ€§ï¼Œå°±æ˜¯ç»™æ¯ä¸ªäººå‘çš„å¥–å“é‡Œçš„passwdæ˜¯ä¸ä¸€æ ·çš„ã€‚ç»™ç”¨æˆ·å‘å¥–å“çš„æ—¶å€™éœ€è¦æ›´æ–°è¿™ä¸ªè¡¨çš„æ•°æ®çŠ¶æ€ã€‚è¯­å¥å¦‚ä¸‹ï¼š
  UPDATE
  prize
  SET
  STATUS = 1,
  name = 'aaa'
  WHERE STATUS = 0
  LIMIT 1
  æ ¹æ®æ–‡ç« çš„å†…å®¹ï¼Œå¦‚æœåŒæ—¶æœ‰1000ä¸ªå¹¶å‘çš„è¯ï¼Œ ä¼šè¶…æˆé”å†²çªï¼Œä½†åœ¨å‘å¥–å“çš„æ—¶å€™ï¼Œè¿™ä¸ªå¥–å“å‘ç»™è°æ˜¯ä¸ç¡®å®šçš„ï¼Œ æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„è§£å†³åŠæ³•ä¹ˆã€‚

  2018-12-27 15:23

  ä½œè€…å›å¤

  å—¯ï¼Œä½ è¿™æ ·å†™å†²çªå¤ªå‰å®³äº†ï¼Œ

  æ˜¯ä¸æ˜¯å¯ä»¥æ”¹ç”¨idåšæ¡ä»¶æ¥æ›´æ–°ï¼Ÿ

  å…¶å®å‘å¥–å“ä¸ä¸€å®šè¦å‘ç¬¬ä¸€ä¸ªå¯¹å§

  2018-12-27 17:09

- 

  å®‰å°ä¾

  æ—è€å¸ˆï¼Œæˆ‘æ˜¯ä¸€åç ”ç©¶ç”Ÿï¼Œçˆ¬è™«çˆ¬æ–°é—»å­˜æ•°æ®åˆ° MySQL é‡Œï¼Œçªç„¶ MySQL å´©æ‰äº†ï¼Œé‡å¯ä¸è¡Œï¼ŒæŸ¥çœ‹æ—¥å¿— çœ‹åˆ°
  [ERROR] /usr/sbin/mysqld: The table 'articles' is full
  InnoDB: Failing assertion: offset > 0
  InnoDB: We intentionally generate a memory trap.
  InnoDB: Submit a detailed bug report to http://bugs.mysql.com.
  InnoDB: If you get repeated assertion failures or crashes, even
  InnoDB: immediately after the mysqld startup, there may be
  InnoDB: corruption in the InnoDB tablespace. Please refer to
  InnoDB: http://dev.mysql.com/doc/refman/5.7/en/forcing-innodb-recovery.html
  InnoDB: about forcing recovery.
  09:37:14 UTC - mysqld got signal 6 ;
  This could be because you hit a bug. It is also possible that this binary
  or one of the libraries it was linked against is corrupt, improperly built,
  or misconfigured. This error can also be caused by malfunctioning hardware.
  Attempting to collect some information that could help diagnose the problem.
  As this is a crash and something is definitely wrong, the information
  collection process might fail.

  key_buffer_size=16777216
  read_buffer_size=131072
  max_used_connections=50
  max_threads=151
  thread_count=48
  connection_count=48
  It is possible that mysqld could use up to
  key_buffer_size + (read_buffer_size + sort_buffer_size)*max_threads = 75719 K bytes of memory
  Hope that's ok; if not, decrease some variables in the equation.

  [Warning] InnoDB: Page 9 in the doublewrite buffer is not within space bounds: page [page id: space=36, page number=113547]

  å‚è€ƒç½‘ä¸Šä½¿ç”¨ innodb_force_recovery è¯•äº†å‡ ä¸ªï¼Œåªæœ‰ 6 å¯ä»¥é‡å¯ mysql æˆåŠŸï¼Œä½†æ˜¯é‡å¯åï¼Œè™½ç„¶æ•°æ®åº“è¿˜åœ¨ï¼Œå¯æ˜¯ä»è¡¨ articles æŸ¥è¯¢ï¼Œå´æç¤ºè¡¨ä¸å­˜åœ¨ã€‚çœ‹æ—¥å¿—

  [ERROR] InnoDB: Failed to find tablespace for table `news`.`articles` in the cache. Attempting to load the tablespace with space id 36

  æ‰€æœ‰æ•°æ®ibd,frmç­‰è¿˜åœ¨ï¼Œå°±æ˜¯å¯åŠ¨ä¸èµ·æ¥ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ç°åœ¨å¦‚ä½•æ‰èƒ½é‡å¯æˆåŠŸæˆ–è€…æ¢å¤æˆ‘çš„æ•°æ®å•Šï¼Œè¾›è‹¦çˆ¬äº†2ä¸ªæœˆçˆ¬è™«ï¼Œ70ä¸‡ç¯‡æ–‡ç« ï¼Œç»“æœä¸€ä¸‹å›åˆ°è§£æ”¾å‰äº†ã€‚

  2018-11-29 19:26

  ä½œè€…å›å¤

  æ•°æ®å­—å…¸æ²¡äº†ï¼Œåªä»æ•°æ®æ¢å¤åšæ³•å¾ˆå¤æ‚ã€‚æœ‰binlogå—

  2018-11-29 23:18

- 

  bing

  åœ¨å¼€å‘æ—¶ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§é¡ºåºåŠ é”æ¥é¿å…æ­»é”ã€‚æ¯”å¦‚éƒ½æ˜¯æŒ‰ç…§å…ˆæ‹¿t1,å†æ‹¿t2.

  2018-11-28 22:08

  ä½œè€…å›å¤

  æ˜¯ä¸ªå¥½çš„å®è·µç»éªŒğŸ‘ğŸ¿

  2018-11-30 08:20



åŠ å¾®ä¿¡heibaifkï¼Œç½‘ç›˜åœæ­¢æ›´æ–°