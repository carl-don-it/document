# 基础

如果单元测试测得通那就直接测，不需要mock数据。

如果程序还没有写好，或者第三方没有调通，可以mock。

如果要测试http请求，那么最好mock第三方server（会发送完整的http，也是请求，只不过服务器是我们自己mock的，看http请求是否写得准确。），否则直接把整个类mock掉。



# springmvc

[玩转单元测试之WireMock -- Web服务模拟器](https://www.cnblogs.com/wade-xu/p/4299710.html)

> 构建一个WireMockServer，注入一些服务，来测试http，可用来模拟**第三方**，不需要依赖spring。
>
> 不仅可以设置一个服务器，还可以不同的http对应不同的host（在stubfor中设置）。

[就是这么简单(续)！使用 RestAssuredMockMvc 测试 Spring MVC Controllers ](https://www.cnblogs.com/wade-xu/p/4311205.html)

> 测试mvc的。mock一个server装载controller去测试。

[玩转单元测试之Testing Spring MVC Controllers](https://www.cnblogs.com/wade-xu/p/4311657.html)

> 和上面一样，也是测试controller的东西。

[玩转单元测试之DBUnit ](https://www.cnblogs.com/wade-xu/p/4547381.html)

> 没用上，数据库的

[就是这么简单！使用Rest-assured 测试Restful Web Services ](https://www.cnblogs.com/wade-xu/p/4298819.html)

> 测试http的东西

Spring Boot实战 ,丁雪丰 (译者) 

> 测试mvc，mock一个server装载controller或者一整个spring去测试mvc
>
> 测试spring security

# json

[技术那么多，你想看看JSON Schema的测试吗？ ](https://www.cnblogs.com/wade-xu/p/4662127.html)

> 测试schema的东西

# wiremock

https://wiremock.org/

[Mock技术的深度理解及WireMock框架基础使用](https://blog.csdn.net/qq_36792120/article/details/121770715)

[结合spring-boot做集成测试](https://github.com/carl-don-it/mockmvc)

```java
package com.dc.dmc.crawl.admin;

import com.github.tomakehurst.wiremock.WireMockServer;
import com.github.tomakehurst.wiremock.core.WireMockConfiguration;
import com.github.tomakehurst.wiremock.http.JvmProxyConfigurer;
import lombok.extern.slf4j.Slf4j;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpHeaders;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultHandlers;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

import javax.annotation.Resource;

@Slf4j
@SpringBootTest(classes = CrawlAdminApplication.class, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc //注解配置一个mockmvc
public class CrawlAdminApplicationTest {

    @Resource
    MockMvc mockMvc;

    private WireMockServer wireMockServer;

    @Before
    public void setup() {
        // 开一个模拟的服务器，代表第三方
        wireMockServer = new WireMockServer(WireMockConfiguration.options()
                .enableBrowserProxying(true)
                .dynamicPort()
                .dynamicHttpsPort()
                .trustAllProxyTargets(true));
        wireMockServer.start();
        //代理所有请求
        JvmProxyConfigurer.configureFor(wireMockServer);
    }

    @After
    public void destroy() {
        wireMockServer.stop();
        JvmProxyConfigurer.restorePrevious();
    }

    @Test
    public void test1() throws Exception {
        //模拟请求，也可以直接发起一个http请求，没啥区别，测试用前者吧
        mockMvc.perform(MockMvcRequestBuilders.post("/crawl/sdfsd")
                .content("{}")
                .headers(new HttpHeaders()))
                .andExpect(MockMvcResultMatchers.status().is4xxClientError())
                .andDo(MockMvcResultHandlers.print())
                .andReturn();

    }
}
```

![image-20230428161019989](img/image-20230428161019989.png)